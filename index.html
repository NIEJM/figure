<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>productLists</title>
	<link rel="stylesheet" href="css/animate.css">
</head>
<body>
	<div class="slideContainer">
		<ul class="slideLists">
			<li>1</li>
			<li>2</li>
			<li>3</li>
			<li>4</li>
			<li>5</li>

		</ul>
	</div>
<script>
var slideContainer = document.getElementsByClassName('slideContainer');
var slideContainer_W = slideContainer[0].clientWidth;//页面宽度
var slideLis = slideContainer[0].getElementsByTagName('li');//图片集
var slideUl = document.getElementsByClassName('slideLists');
var slideLists_W = slideLis[0].clientWidth;//每个图片的宽度
console.log(slideLists_W,slideContainer_W);
slideUl[0].style.left = 0 + 'px';
var time=100,animated=false,interval=10,pre=0,show=0,next=0,animated=false;
for(var i=0;i<slideLis.length;i++){
	slideLis[i].index = i;
	if(i==0){
		slideLis[i].style.left = 0 + 'px';
	}else if(i==1){
		slideLis[i].style.left = slideContainer_W*0.6 + 'px';
	}else{
		slideLis[i].style.left = slideContainer_W + 'px';
	}
}
function slideRun(el,offset){//动画运行
	var slideUlLeft = parseFloat(el.style.left);
	var speed = offset/(time/interval);
	var slideUlNowL = slideUlLeft + offset;
	function slideAnimate(){
		// console.log(slideUlLeft,slideUlLeft < slideUlNowL)
		slideUlLeft = parseFloat(el.style.left);
		// console.log(slideUlLeft)
		if(slideUlLeft > slideUlNowL && speed < 0 || slideUlLeft < slideUlNowL && speed > 0){
			if(slideUlLeft + speed < slideUlNowL || slideUlLeft + speed < slideUlNowL){
				el.style.left = slideUlNowL + 'px';
			}else{
				el.style.left = slideUlLeft + speed + 'px';
				setTimeout(arguments.callee,interval);
			}
			
		}
	}
	slideAnimate();
}
var startX = 0,endX=0,slideX=0,startArray = [],endArray=[],
	slideX0=0,slideX1=0,slideX2=0,direct,
	isTouchEnd=true,isMove=false;
document.ontouchstart = function(e){//手指触摸屏幕
	var e = e || window.e;
	if(isTouchEnd && e.touches.length ==1){
		startX = e.touches[0].pageX;
		showIndex(startX,e);
		startArray = getLeft();
		// console.log(startArray,1);
		isTouchEnd=false;
		isMove = false;
	}
}
function showIndex(startX,e){//获取当前页面的序列号的值
	show = startX < slideLists_W ? e.target.index : e.target.index -1;
}
function getLeft(){//获取所有图片的当前偏移值
	var leftArray = [];
	for(var i=0;i<slideLis.length;i++){
		leftArray.push(parseFloat(slideLis[i].style.left));
	}
	return leftArray;
}

document.ontouchmove = function(e){//手指在屏幕滑动
	var e = e || window.e;
	if(isTouchEnd){return};
	// e.preventDefault();
	endX = e.touches[0].pageX;
	slideX = endX - startX;
	direct = direction(slideX);
	slideX0 = slideX;
	slideX1 = slideX * (slideContainer_W*0.6/slideLists_W);
	slideX2 = slideX * (slideContainer_W*0.4/slideLists_W);

	// console.log(slideX);
	if(direct == 'left'){
		switch(show){
			case slideLis.length-1:
			slideLeft(slideLis[show],slideX0,startArray[show]);
			break;
			case slideLis.length-2:
			slideLeft(slideLis[show],slideX0,startArray[show]);
			slideLeft(slideLis[show+1],slideX1,startArray[show+1]);
			break;
			default:console.log(slideX0);
			slideLeft(slideLis[show],slideX0,startArray[show]);
			slideLeft(slideLis[show+1],slideX1,startArray[show+1]);
			slideLeft(slideLis[show+2],slideX2,startArray[show+2]);
			break;
		}
	}else if(direct == 'right'){
		switch(show){
			case 0:
			slideLeft(slideLis[show],slideX1,startArray[show]);
			slideLeft(slideLis[show+1],slideX2,startArray[show+1]);
			break;
			case slideLis.length-1:
			slideLeft(slideLis[show-1],slideX0,startArray[show-1]);
			slideLeft(slideLis[show],slideX1,startArray[show]);
			break;
			default:
			slideLeft(slideLis[show-1],slideX0,startArray[show-1]);
			slideLeft(slideLis[show],slideX1,startArray[show]);
			slideLeft(slideLis[show+1],slideX2,startArray[show+1]);
			break;
		}
	}
	isMove = true;
	
}

function direction(slideX){//获取当前的滑动的方向
	var direct;
	return direct = slideX<0 ? 'left' : 'right';
}

function slideLeft(el,moveLeft,nowLeft){//手指滑动时，页面也跟随滑动
	el.style.left = nowLeft + moveLeft + "px";
}

document.ontouchend = function(e){//手指离开屏幕
	var e = e || window.e;
	if(isMove && !isTouchEnd){
		changeLeft();
		endArray = getLeft();
		if(Math.abs(slideX)<slideContainer_W*0.3){
			switch(show){
				case 0:direct == 'left' ?
				(slideRun(slideLis[show],-slideX0),
				slideRun(slideLis[show+1],-slideX1),
				slideRun(slideLis[show+2],-slideX2))
				:(slideRun(slideLis[show],-slideX1),
				slideRun(slideLis[show+1],-slideX2))
				break;
				case slideLis.length-1:direct == 'left' ?
				(slideRun(slideLis[show],-slideX0))
				:(slideRun(slideLis[show-1],-slideX0),
				slideRun(slideLis[show],-slideX1))
				break;
				default:direct == 'left' ?
				(slideRun(slideLis[show],-slideX0),
				slideRun(slideLis[show+1],-slideX1),
				slideRun(slideLis[show+2],-slideX2))
				:(slideRun(slideLis[show-1],-slideX0),
				slideRun(slideLis[show],-slideX1),
				slideRun(slideLis[show+1],-slideX2))
				break;
			}
		}else{
			if(direct == 'left'){
				switch(show){
					case slideLis.length-1:
					slideRun(slideLis[show],-slideX0);
					break;
					case slideLis.length-2:
					slideRun(slideLis[show],-slideLists_W-slideX0);
					slideRun(slideLis[show+1],-slideContainer_W*0.6-slideX1);
					break;
					default:console.log(-slideLists_W-slideX0);
					slideRun(slideLis[show],-slideLists_W-slideX0);
					slideRun(slideLis[show+1],-slideContainer_W*0.6-slideX1);
					slideRun(slideLis[show+2],-slideContainer_W*0.4-slideX2);
					break;
				}
			}else if(direct == 'right'){
				switch(show){
					case 0:
					slideRun(slideLis[show],-slideX1);
					slideRun(slideLis[show+1],-slideX2);
					break;
					case slideLis.length-1:
					slideRun(slideLis[show-1],slideLists_W-slideX0);
					slideRun(slideLis[show],slideContainer_W*0.6-slideX1);
					break;
					default:
					slideRun(slideLis[show-1],slideLists_W-slideX0);
					slideRun(slideLis[show],slideContainer_W*0.6-slideX1);
					slideRun(slideLis[show+1],slideContainer_W*0.4-slideX2);
					break;
				}	
			}
		}
	}
	isTouchEnd = true;
}
function changeLeft(){//调整所有图片的偏移位置
	for(var i=0;i<slideLis.length;i++){
		if(parseFloat(slideLis[i].style.left)<=-slideLists_W){
			slideLis[i].style.left = -slideLists_W + 'px';
		}else if(parseFloat(slideLis[i].style.left)>=slideContainer_W){
			slideLis[i].style.left = slideContainer_W + 'px';
		}
	}
}
</script>
</body>
</html>